<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="Wavee.UI.WinUI.Views.Library.LibrarySongsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:Wavee.UI.WinUI.Views.Library"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:Wavee.UI.WinUI.Controls"
             Unloaded="LibrarySongsView_OnUnloaded"
             xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
             xmlns:behaviors="using:Wavee.UI.WinUI.Behaviors"
             xmlns:ui="using:CommunityToolkit.WinUI.UI"
             mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="100" />
        </Grid.RowDefinitions>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Margin="0,12,12,12"
                  HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"
                                      MaxWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition MaxWidth="300" />
                </Grid.ColumnDefinitions>
                <DropDownButton>
                    <TextBlock FontSize="14"
                               xml:space="preserve"><Run Text="Sort by: " /><Run FontWeight="SemiBold"
                                                                                 Foreground="{ThemeResource FocusTextThemeBrush}"
                                                                                 Text="{x:Bind ViewModel.SortBy, Mode=OneWay, Converter={StaticResource SortTranslatorConverter}}" /></TextBlock>
                    <DropDownButton.Flyout>
                        <Flyout>
                            <ListView Padding="-2"
                                      Margin="-12"
                                      x:Name="ExtendSortLv"
                                      SelectionChanged="ExtendSortLv_OnSelectionChanged"
                                      ItemsSource="{x:Bind ViewModel.ExtendedSortOptions}"
                                      SelectedItem="{x:Bind ViewModel.SortBy, Mode=OneWay}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Mode=OneTime, Converter={StaticResource SortTranslatorConverter}}" />
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Flyout>
                    </DropDownButton.Flyout>
                </DropDownButton>
                <CheckBox Grid.Column="1"
                          Margin="12,0,0,0"
                          x:Name="AscendingBox"
                          Content="Ascending"
                          Tapped="AscendingTapped"
                          IsChecked="{x:Bind ViewModel.SortAscending, Mode=OneWay}" />
                <CheckBox Grid.Column="2"
                          x:Load="{x:Bind ViewModel.HasHeartedFilter, Mode=OneWay}"
                          x:Name="HeartedFilterBox"
                          Margin="0,0,0,0"
                          Content="Only hearted"
                          IsChecked="{x:Bind ViewModel.HeartedFilter, Mode=TwoWay}" />
                <AutoSuggestBox QueryIcon="Find"
                                Height="34"
                                PlaceholderText="Search for tracks..."
                                Margin="0,0"
                                Grid.Column="3" />
            </Grid>


            <Border Grid.Row="1"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    HorizontalAlignment="Stretch"
                    CornerRadius="8"
                    Margin="0,0,14,0"
                    Padding="16,8"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="43"
                                          Width="Auto" />
                        <ColumnDefinition Width="8" />
                        <ColumnDefinition Width="34" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width=".7*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>

                    <!-- The index button will flip the sort (ascending <-> descending)  -->
                    <controls:SortButton SortContext="{x:Bind ViewModel}"
                                         SortBy="{x:Null}"
                                         Grid.ColumnSpan="3"
                                         Margin="0,0,48,0"
                                         Padding="0"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Center">
                        <TextBlock Text="#"
                                   FontWeight="Bold"
                                   FontSize="18"
                                   Opacity=".8" />
                    </controls:SortButton>

                    <controls:SortButton SortContext="{x:Bind ViewModel}"
                                         SortBy="Title"
                                         Margin="0,0"
                                         Grid.Column="3"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch" />

                    <controls:SortButton SortBy="Artist"
                                         SortContext="{x:Bind ViewModel}"
                                         Margin="0,0"
                                         Grid.Column="5"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch" />

                    <controls:SortButton SortBy="Album"
                                         SortContext="{x:Bind ViewModel}"
                                         Margin="0,0"
                                         Grid.Column="7"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch" />

                    <controls:SortButton SortBy="{x:Bind ViewModel.ExtraGroupString, Mode=OneWay}"
                                         SortContext="{x:Bind ViewModel}"
                                         Margin="0,0"
                                         Grid.Column="9"
                                         IsSpecialSort="True"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch" />


                    <controls:SortButton SortBy="Duration"
                                         SortContext="{x:Bind ViewModel}"
                                         Margin="4,0"
                                         Grid.Column="11"
                                         HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch">
                        <FontIcon FontFamily="Segoe Fluent Icons"
                                  FontWeight="SemiBold"
                                  FontSize="16"
                                  Opacity=".8"
                                  HorizontalAlignment="Left"
                                  Glyph="&#xE916;" />
                    </controls:SortButton>
                </Grid>
            </Border>
        </Grid>
        <ListView Grid.Row="1"
                  ui:ScrollViewerExtensions.VerticalScrollBarMargin="0,0,0,100"
                  Grid.RowSpan="2"
                  SelectionMode="Extended"
                  DataContext="{x:Bind ViewModel}"
                  x:Name="TrackListView"
                  ItemTemplate="{StaticResource LibraryTrack}"
                  ItemsSource="{x:Bind Tracks, Mode=OneWay}">
            <interactivity:Interaction.Behaviors>
                <behaviors:PlaybackListBehavior />
            </interactivity:Interaction.Behaviors>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem"
                       BasedOn="{StaticResource DefaultListViewItemStyle}">
                    <Setter Property="Padding"
                            Value="0,0,14,0" />
                    <Setter Property="Margin"
                            Value="0,2" />
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.Footer>
                <Border Height="100" />
            </ListView.Footer>
        </ListView>
    </Grid>
</UserControl>

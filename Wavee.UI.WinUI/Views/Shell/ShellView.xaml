<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Wavee.UI.WinUI.Views.Shell.ShellView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:property="using:Wavee.UI.WinUI.Sizer.Property" xmlns:winUi="using:CommunityToolkit.Labs.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:templateSelectors="using:Wavee.UI.WinUI.TemplateSelectors"
    xmlns:shell="using:Wavee.UI.ViewModels.Shell"
    xmlns:library="using:Wavee.UI.ViewModels.Library"
    xmlns:animations="using:CommunityToolkit.WinUI.UI.Animations"
    xmlns:identity="using:Wavee.UI.WinUI.Views.Identity"
    xmlns:controls1="using:Wavee.UI.WinUI.Controls"
    DragOver="ShellView_OnDragOver"
    Drop="ShellView_OnDrop"
    AllowDrop="{x:Bind IsLocal(ViewModel.UserViewModel.User.ServiceType), Mode=OneTime}"
    xmlns:xamlConverters="using:Wavee.UI.WinUI.XamlConverters"

    mc:Ignorable="d">
    <UserControl.Resources>
        <xamlConverters:ViewLocator x:Key="ViewLocator" />
        <DataTemplate x:Key="Header" x:DataType="shell:SidebarHeader">
            <NavigationViewItemHeader Content="{x:Bind Title}"/>
        </DataTemplate>
        <DataTemplate x:Key="Playlist" x:DataType="shell:SidebarItemViewModel">
            <NavigationViewItem 
                IsEnabled="{x:Bind IsEnabled}"
                Tag="{x:Bind Id}"
                Content="{x:Bind Title}">
                <NavigationViewItem.Icon>
                    <FontIcon Glyph="{x:Bind Icon}" FontFamily="{x:Bind GlyphFontFamily}"/>
                </NavigationViewItem.Icon>
            </NavigationViewItem>
        </DataTemplate>
        <DataTemplate x:Key="Library" x:DataType="library:LibraryViewModelFactory">
            <NavigationViewItem 
                IsEnabled="{x:Bind IsEnabled}"
                Tag="{x:Bind Id}"
                Content="{x:Bind Title}">
                <NavigationViewItem.InfoBadge>
                    <InfoBadge Value="{x:Bind Count}"/>
                </NavigationViewItem.InfoBadge>
                <NavigationViewItem.Icon>
                    <FontIcon Glyph="{x:Bind Icon}"
                              FontFamily="{x:Bind GlyphFontFamily}"/>
                </NavigationViewItem.Icon>
            </NavigationViewItem>
        </DataTemplate>
        <templateSelectors:SidebarTemplateSelector 
            x:Key="SidebarTemplateSelector" 
            Header="{StaticResource Header}" 
            Library="{StaticResource Library}" 
            Playlist="{StaticResource Playlist}"
        />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="100"/>
        </Grid.RowDefinitions>
        <NavigationView IsBackButtonVisible="Collapsed" 
                        x:Name="ViewPanel"  Grid.RowSpan="2"
                        Style="{StaticResource HeaderOffsetedNavViewStyle}"
                        IsSettingsVisible="False" 
                        ItemInvoked="ViewPanel_OnItemInvoked"
                        SelectedItem="{x:Bind ViewModel.SelectedSidebarItem, Mode=OneWay}"
                        IsPaneOpen="{x:Bind ViewModel.IsPaneOpen, Mode=TwoWay}" 
                        CompactModeThresholdWidth="0"
                        AlwaysShowHeader="{x:Bind ShouldShowHeader(ViewModel.SelectedSidebarItem), Mode=OneWay}"
                        MenuItemTemplateSelector="{StaticResource SidebarTemplateSelector}"
                        MenuItemsSource="{x:Bind ViewModel.SidebarItems}"
                        OpenPaneLength="{x:Bind ViewModel.OpenPaneLength, Mode=OneWay}"
                        PaneDisplayMode="Left">
            <NavigationView.AutoSuggestBox>
                <AutoSuggestBox QueryIcon="Find" PlaceholderText="I'm looking for..."/>
            </NavigationView.AutoSuggestBox>
            <NavigationView.Header>
                <Grid Margin="0,0,0,5"
                      Visibility="{x:Bind ShouldShowHeaderVisibility(ViewModel.SelectedSidebarItem), Mode=OneWay}">
                    <animations:Implicit.ShowAnimations>
                        <animations:TranslationAnimation EasingMode="EaseInOut"
                                                         Duration="0:0:0.3" From="0, -30, 0" To="0, 0,0 "/>
                        <animations:OpacityAnimation EasingMode="EaseInOut"
                                                     Duration="0:0:0.3" From="0" To="1.0"/>
                    </animations:Implicit.ShowAnimations>

                    <animations:Implicit.HideAnimations>
                        <animations:OpacityAnimation EasingMode="EaseOut" Duration="0:0:0.3" To="0.0"/>
                        <animations:TranslationAnimation EasingMode="EaseOut" Duration="0:0:0.6" From="0, 0, 0" To="0, -50,0"/>
                    </animations:Implicit.HideAnimations>
                    <NavigationView PaneDisplayMode="Top" IsBackButtonVisible="Collapsed" IsSettingsVisible="False">
                        <NavigationView.Resources>
                            <Thickness x:Key="TopNavigationViewContentGridBorderThickness">0</Thickness>
                        </NavigationView.Resources>
                        <NavigationView.MenuItems>
                            <NavigationViewItem Content="Welcome"/>
                            <NavigationViewItem Content="Music"/>
                            <NavigationViewItem Content="Shows &amp; Podcasts"/>

                        </NavigationView.MenuItems>
                    </NavigationView>
                </Grid>
            </NavigationView.Header>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  Note the use of a TwoWay binding here, this is required for this control to work.  -->
                <property:PropertySizer HorizontalAlignment="Left"
                                        Binding="{x:Bind ViewModel.OpenPaneLength, Mode=TwoWay}"
                                        Maximum="440"
                                        Cursor="SizeWestEast"
                                        Minimum="52"
                                        Visibility="{x:Bind ViewModel.IsPaneOpen, Mode=OneWay}" />

                <Grid Grid.Column="1" Padding="0,0,0,1">
                    <ContentControl VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch"
                                    Content="{x:Bind NavigationService.Current, Mode=OneWay, Converter={StaticResource 
                                    ViewLocator}}"
                    />
                </Grid>
            </Grid>
        </NavigationView>

        <controls1:BottomPlayerControl
            ViewModel="{x:Bind ViewModel.PlayerViewModel, Mode=OneTime}"
            Grid.Row="1"/>
    </Grid>
</UserControl>
